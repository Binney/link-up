!function(){var e,t=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};e=["extended","included"],this.Gmaps4Rails={},this.Gmaps4Rails.Common=function(){function r(){}return r.extend=function(r){var o,n,i;for(o in r)n=r[o],t.call(e,o)<0&&(this[o]=n);return null!=(i=r.extended)&&i.apply(this),this},r.include=function(r){var o,n,i;for(o in r)n=r[o],t.call(e,o)<0&&(this.prototype[o]=n);return null!=(i=r.included)&&i.apply(this),this},r.prototype.exists=function(e){return""!==e&&"undefined"!=typeof e},r.prototype.mergeObjects=function(e,t){return this.constructor.mergeObjects(e,t)},r.mergeObjects=function(e,t){var r,o,n;r={};for(o in e)n=e[o],r[o]=n;for(o in t)n=t[o],null==r[o]&&(r[o]=n);return r},r.mergeWith=function(e){var t,r,o;o=[];for(t in e)r=e[t],null==this[t]?o.push(this[t]=r):o.push(void 0);return o},r.prototype.random=function(){return 2*Math.random()-1},r}()}.call(this),function(){this.Gmaps4Rails.Configuration={setConf:function(){return null!=this.CONF?this.mergeObjects(this.CONF,this.DEFAULT_CONF):this.DEFAULT_CONF}}}.call(this),function(){this.Gmaps={triggerOldOnload:function(){return"function"==typeof window.Gmaps.oldOnload?window.Gmaps.oldOnload():void 0},loadMaps:function(){var e,t,r,o;r=window.Gmaps,o=[];for(e in r)t=r[e],/^load_/.test(e)?o.push(window.Gmaps[e]()):o.push(void 0);return o}}}.call(this),function(){this.Gmaps4Rails.Circle={},this.Gmaps4Rails.Circle.Class={DEFAULT_CONF:{fillColor:"#00AAFF",fillOpacity:.35,strokeColor:"#FFAA00",strokeOpacity:.8,strokeWeight:2,clickable:!1,zIndex:null}}}.call(this),function(){this.Gmaps4Rails.Kml={},this.Gmaps4Rails.Kml.Instance={DEFAULT_CONF:{clickable:!0,preserveViewport:!1,suppressInfoWindows:!1}}}.call(this),function(){this.Gmaps4Rails.Map={DEFAULT_CONF:{id:"map",draggable:!0,detect_location:!1,center_on_user:!1,center_latitude:0,center_longitude:0,zoom:7,maxZoom:null,minZoom:null,auto_adjust:!0,auto_zoom:!0,bounds:[],raw:{}},adjustToBounds:function(){return this.boundsObject=this.createLatLngBounds(),this.extendBoundsWithMarkers(),this.extendBoundsWithPolylines(),this.extendBoundsWithPolygons(),this.extendBoundsWithCircles(),this.extendBoundsWithLatLng(),this.adaptToBounds()},extendBoundsWithMarkers:function(){var e,t,r,o,n;for(o=this.controller.markers,n=[],t=0,r=o.length;r>t;t++)e=o[t],e.isVisible()?n.push(this.extendBoundsWithMarker(e)):n.push(void 0);return n},extendBoundsWithPolylines:function(){var e,t,r,o,n;for(o=this.controller.polylines,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(this.extendBoundsWithPolyline(e));return n},extendBoundsWithPolygons:function(){var e,t,r,o,n;for(o=this.controller.polygons,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(this.extendBoundsWithPolygon(e));return n},extendBoundsWithCircles:function(){var e,t,r,o,n;for(o=this.controller.circles,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(this.extendBoundsWithCircle(e));return n},extendBoundsWithLatLng:function(){var e,t,r,o,n;for(o=this.options.bounds,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(this.extendBound(e));return n},autoAdjustRequested:function(){return this.options.auto_adjust||this.options.bounds.length>0}}}.call(this),function(){this.Gmaps4Rails.Marker={},this.Gmaps4Rails.Marker.Class={DEFAULT_CONF:{title:null,picture:null,width:22,length:32,draggable:!1,do_clustering:!1,randomize:!1,max_random_distance:100,list_container:null,offset:0,raw:{}}},this.Gmaps4Rails.Marker.Instance={getMap:function(){return this.controller.getMapObject()}}}.call(this),function(){this.Gmaps4Rails.Polygon={},this.Gmaps4Rails.Polygon.Class={DEFAULT_CONF:{strokeColor:"#FFAA00",strokeOpacity:.8,strokeWeight:2,fillColor:"#000000",fillOpacity:.35,clickable:!1}}}.call(this),function(){this.Gmaps4Rails.Polyline={},this.Gmaps4Rails.Polyline.Class={DEFAULT_CONF:{strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,clickable:!1,zIndex:null,icons:null}}}.call(this),function(){this.Gmaps4Rails.CircleController={addCircles:function(e){var t,r,o,n;for(n=[],r=0,o=e.length;o>r;r++)t=e[r],n.push(this.circles.push(this.createCircle(t)));return n},replaceCircles:function(e){return this.clearCircles(),this.addCircles(e),this.adjustMapToBounds()},clearCircles:function(){var e,t,r,o;for(o=this.circles,t=0,r=o.length;r>t;t++)e=o[t],e.clear();return this.circles=[]},showCircles:function(){var e,t,r,o,n;for(o=this.circles,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.show());return n},hideCircles:function(){var e,t,r,o,n;for(o=this.circles,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.hide());return n}}}.call(this),function(){this.Gmaps4Rails.KmlController={addKml:function(e){var t,r,o,n;for(n=[],r=0,o=e.length;o>r;r++)t=e[r],n.push(this.kmls.push(this.createKml(t)));return n}}}.call(this),function(){this.Gmaps4Rails.MarkerController={addMarkers:function(e){var t,r,o,n,i,s,l,a;for(null!=this.markerClusterer&&this.clearClusterer(),t=l=0,a=e.length;a>l;t=++l)i=e[t],r=i.lat,n=i.lng,this.markers_conf.randomize&&(o=this.randomize(r,n),r=o[0],n=o[1]),s=this.createMarker({marker_picture:i.picture?i.picture:this.markers_conf.picture,marker_width:i.width?i.width:this.markers_conf.width,marker_height:i.height?i.height:this.markers_conf.length,marker_title:i.title?i.title:null,marker_anchor:i.marker_anchor?i.marker_anchor:null,shadow_anchor:i.shadow_anchor?i.shadow_anchor:null,shadow_picture:i.shadow_picture?i.shadow_picture:null,shadow_width:i.shadow_width?i.shadow_width:null,shadow_height:i.shadow_height?i.shadow_height:null,marker_draggable:i.draggable?i.draggable:this.markers_conf.draggable,rich_marker:i.rich_marker?i.rich_marker:null,zindex:i.zindex?i.zindex:null,lat:r,lng:n,index:t}),Gmaps4Rails.Common.mergeWith.call(s,i),s.createInfoWindow(),this.markers.push(s);return this.clusterize()},replaceMarkers:function(e){return this.clearMarkers(),this.markers=[],this.boundsObject=this.createLatLngBounds(),this.addMarkers(e)},clearMarkers:function(){var e,t,r,o;for(null!=this.markerClusterer&&this.clearClusterer(),o=this.markers,t=0,r=o.length;r>t;t++)e=o[t],e.clear();return this.markers=[]},showMarkers:function(){var e,t,r,o,n;for(o=this.markers,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.show());return n},hideMarkers:function(){var e,t,r,o,n;for(o=this.markers,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.hide());return n},randomize:function(e,t){var r,o,n,i;return n=this.markers_conf.max_random_distance*this.random(),i=this.markers_conf.max_random_distance*this.random(),r=parseFloat(e)+180/Math.PI*(i/6378137),o=parseFloat(t)+90/Math.PI*(n/6378137)/Math.cos(e),[r,o]}}}.call(this),function(){this.Gmaps4Rails.PolygonController={addPolygons:function(e){var t,r,o,n;for(n=[],r=0,o=e.length;o>r;r++)t=e[r],n.push(this.polygons.push(this.createPolygon(t)));return n},replacePolygons:function(e){return this.clearPolygons(),this.addPolygons(e),this.adjustMapToBounds()},clearPolygons:function(){var e,t,r,o;for(o=this.polygons,t=0,r=o.length;r>t;t++)e=o[t],e.clear();return this.polygons=[]},showPolygons:function(){var e,t,r,o,n;for(o=this.polygons,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.show());return n},hidePolygons:function(){var e,t,r,o,n;for(o=this.polygons,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.hide());return n}}}.call(this),function(){this.Gmaps4Rails.PolylineController={replacePolylines:function(e){return this.clearPolylines(),this.addPolylines(e),this.adjustMapToBounds()},clearPolylines:function(){var e,t,r,o;for(o=this.polylines,t=0,r=o.length;r>t;t++)e=o[t],e.clear();return this.polylines=[]},addPolylines:function(e){var t,r,o,n;for(n=[],r=0,o=e.length;o>r;r++)t=e[r],n.push(this.polylines.push(this.createPolyline(t)));return n},showPolylines:function(){var e,t,r,o,n;for(o=this.polylines,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.show());return n},hidePolylines:function(){var e,t,r,o,n;for(o=this.polylines,n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push(e.hide());return n}}}.call(this),function(){Gmaps4Rails.Interfaces||(Gmaps4Rails.Interfaces={}),Gmaps4Rails.Interfaces.Basic={clear:function(){throw"clear should be implemented"},show:function(){throw"show should be implemented"},hide:function(){throw"hide should be implemented"},isVisible:function(){throw"hide should be implemented"}}}.call(this),function(){Gmaps4Rails.Interfaces||(Gmaps4Rails.Interfaces={}),Gmaps4Rails.Interfaces.Controller={getModule:function(){throw"getModule should be implemented in controller"},createClusterer:function(){throw"createClusterer should be implemented in controller"},clearClusterer:function(){throw"clearClusterer should be implemented in controller"}}}.call(this),function(){Gmaps4Rails.Interfaces||(Gmaps4Rails.Interfaces={}),Gmaps4Rails.Interfaces.Map={extendBoundsWithMarker:function(){throw"extendBoundsWithMarker should be implemented in controller"},extendBoundsWithPolyline:function(){throw"extendBoundsWithPolyline should be implemented in controller"},extendBoundsWithPolygon:function(){throw"extendBoundsWithPolygon should be implemented in controller"},extendBoundsWithCircle:function(){throw"extendBoundsWithCircle should be implemented in controller"},extendBound:function(){throw"extendBound should be implemented in controller"},adaptToBounds:function(){throw"adaptToBounds should be implemented in controller"},fitBounds:function(){throw"fitBounds should be implemented in controller"},centerMapOnUser:function(){throw"centerMapOnUser should be implemented in controller"}}}.call(this),function(){Gmaps4Rails.Interfaces||(Gmaps4Rails.Interfaces={}),Gmaps4Rails.Interfaces.Marker={createInfoWindow:function(){throw"createInfoWindow should be implemented in marker"},clear:function(){throw"clear should be implemented in marker"},show:function(){throw"show should be implemented in marker"},hide:function(){throw"hide should be implemented in marker"}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.BaseController=function(e){function r(){this.rootModule=this.getModule(),null!=this.rootModule.Marker&&(this.markers_conf=this.rootModule.Marker.setConf()),null!=this.rootModule.Polyline&&(this.polylines_conf=this.rootModule.Polyline.setConf()),null!=this.rootModule.Polygon&&(this.polygons_conf=this.rootModule.Polygon.setConf()),null!=this.rootModule.Circle&&(this.circles_conf=this.rootModule.Circle.setConf())}return t(r,e),r.include(Gmaps4Rails.MarkerController),r.include(Gmaps4Rails.PolylineController),r.include(Gmaps4Rails.PolygonController),r.include(Gmaps4Rails.CircleController),r.include(Gmaps4Rails.KmlController),r.include(Gmaps4Rails.Interfaces.Controller),r.prototype.visibleInfoWindow=null,r.prototype.userLocation=null,r.prototype.afterMapInitialization=function(){return!1},r.prototype.geolocationSuccess=function(){return!1},r.prototype.geolocationFailure=function(){return!1},r.prototype.callback=function(){return!1},r.prototype.customClusterer=function(){return!1},r.prototype.infobox=function(){return!1},r.prototype.jsTemplate=!1,r.prototype.map_options={},r.prototype.markers=[],r.prototype.boundsObject=null,r.prototype.polygons=[],r.prototype.polylines=[],r.prototype.circles=[],r.prototype.markerClusterer=null,r.prototype.markerImages=[],r.prototype.kmls=[],r.prototype.rootModule=null,r.prototype.createMap=function(){return new this.rootModule.Map(this.map_options,this)},r.prototype.createMarker=function(e){return new this.rootModule.Marker(e,this)},r.prototype.createPolyline=function(e){return new this.rootModule.Polyline(e,this)},r.prototype.createPolygon=function(e){return new this.rootModule.Polygon(e,this)},r.prototype.createCircle=function(e){return new this.rootModule.Circle(e,this)},r.prototype.createKml=function(e){return new this.rootModule.Kml(e,this)},r.prototype.initialize=function(){var e,t;return t=this.map_options.detect_location||this.map_options.center_on_user,e=this.map_options.center_on_user,this.map=this.createMap(),this.afterMapInitialization(),delete this.map_options,t?this.findUserLocation(this,e):void 0},r.prototype.getMapObject=function(){return this.map.serviceObject},r.prototype.adjustMapToBounds=function(){return this.map.autoAdjustRequested()?this.map.adjustToBounds():void 0},r.prototype.clusterize=function(){var e,t,r,o,n;if(this.markers_conf.do_clustering){for(null!=this.markerClusterer&&this.clearClusterer(),t=[],n=this.markers,r=0,o=n.length;o>r;r++)e=n[r],t.push(e.serviceObject);return this.markerClusterer=this.createClusterer(t)}},r.prototype.findUserLocation=function(e,t){var r,o;return navigator.geolocation?(o=function(r){return e.userLocation=e.createLatLng(r.coords.latitude,r.coords.longitude),e.geolocationSuccess(),t?e.map.centerMapOnUser(e.userLocation):void 0},r=function(){return e.geolocationFailure(!0)},navigator.geolocation.getCurrentPosition(o,r)):e.geolocationFailure(!1)},r}(Gmaps4Rails.Common)}.call(this),function(){}.call(this),function(){Gmaps4Rails.Bing={},Gmaps4Rails.Bing.Shared={createPoint:function(e,t){return new Microsoft.Maps.Point(e,t)},createLatLng:function(e,t){return new Microsoft.Maps.Location(e,t)},createLatLngBounds:function(){},createSize:function(e,t){return new google.maps.Size(e,t)},_addToMap:function(e){return this.controller.getMapObject().entities.push(e)},_removeFromMap:function(e){return this.controller.getMapObject().entities.remove(e)}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Bing.Map=function(e){function r(e,t){var r,o,n;this.controller=t,o=this.setConf(),this.options=this.mergeObjects(e,o),r={credentials:this.options.provider_key,mapTypeId:this._getMapType(this.options),center:this.createLatLng(this.options.center_latitude,this.options.center_longitude),zoom:this.options.zoom},n=this.mergeObjects(e.raw,r),this.serviceObject=new Microsoft.Maps.Map(document.getElementById(this.options.id),n)}return t(r,e),r.include(Gmaps4Rails.Interfaces.Map),r.include(Gmaps4Rails.Map),r.include(Gmaps4Rails.Bing.Shared),r.include(Gmaps4Rails.Configuration),r.prototype.CONF={type:"road"},r.prototype.extendBoundsWithMarkers=function(){var e,t,r,o,n;for(e=[],n=this.controller.markers,r=0,o=n.length;o>r;r++)t=n[r],e.push(t.serviceObject.getLocation());return this.boundsObject=Microsoft.Maps.LocationRect.fromLocations(e)},r.prototype.extendBoundsWithPolyline=function(){},r.prototype.extendBoundsWithPolygon=function(){},r.prototype.extendBoundsWithCircle=function(){},r.prototype.extendBound=function(){},r.prototype.adaptToBounds=function(){return this._fitBounds()},r.prototype.centerMapOnUser=function(e){return this.serviceObject.setView({center:e})},r.prototype._fitBounds=function(){return this.serviceObject.setView({bounds:this.boundsObject})},r.prototype._getMapType=function(e){switch(e.type){case"road":return Microsoft.Maps.MapTypeId.road;case"aerial":return Microsoft.Maps.MapTypeId.aerial;case"auto":return Microsoft.Maps.MapTypeId.auto;case"birdseye":return Microsoft.Maps.MapTypeId.birdseye;case"collinsBart":return Microsoft.Maps.MapTypeId.collinsBart;case"mercator":return Microsoft.Maps.MapTypeId.mercator;case"ordnanceSurvey":return Microsoft.Maps.MapTypeId.ordnanceSurvey;default:return Microsoft.Maps.MapTypeId.auto}},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Bing.Marker=function(e){function r(e,t){var r,o;this.controller=t,o=this.createLatLng(e.lat,e.lng),r=this._createImageAnchorPosition([e.lat,e.lng]),this.serviceObject=null!=e.marker_picture?new Microsoft.Maps.Pushpin(o,{draggable:e.marker_draggable,anchor:r,icon:e.marker_picture,height:e.marker_height,text:e.marker_title,width:e.marker_width}):new Microsoft.Maps.Pushpin(o,{draggable:e.marker_draggable,anchor:r,text:e.marker_title}),this._addToMap(this.serviceObject)}return t(r,e),r.include(Gmaps4Rails.Interfaces.Marker),r.include(Gmaps4Rails.Bing.Shared),r.include(Gmaps4Rails.Marker.Instance),r.extend(Gmaps4Rails.Marker.Class),r.extend(Gmaps4Rails.Configuration),r.CONF={infobox:"description"},r.prototype.createInfoWindow=function(){return null!=this.description?(this.info_window="description"===this.controller.markers_conf.infobox?new Microsoft.Maps.Infobox(this.serviceObject.getLocation(),{description:this.description,visible:!1,showCloseButton:!0}):new Microsoft.Maps.Infobox(this.serviceObject.getLocation(),{htmlContent:this.description,visible:!1}),Microsoft.Maps.Events.addHandler(this.serviceObject,"click",this._openInfoWindow(this.controller,this.info_window)),this._addToMap(this.info_window)):void 0},r.prototype.isVisible=function(){return!0},r.prototype.clear=function(){return this._removeFromMap(this.serviceObject)},r.prototype.show=function(){return this.serviceObject.setOptions({visible:!0})},r.prototype.hide=function(){return this.serviceObject.setOptions({visible:!1})},r.prototype._openInfoWindow=function(e,t){return function(){return e.visibleInfoWindow&&e.visibleInfoWindow.setOptions({visible:!1}),t.setOptions({visible:!0}),e.visibleInfoWindow=t}},r.prototype._createImageAnchorPosition=function(e){return null==e?null:this.createPoint(e[0],e[1])},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4RailsBing=function(e){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,e),r.include(Gmaps4Rails.Bing.Shared),r.prototype.getModule=function(){return Gmaps4Rails.Bing},r.prototype.createClusterer=function(){},r.prototype.clearClusterer=function(){},r.prototype.clearMarkers=function(){},r}(Gmaps4Rails.BaseController)}.call(this),function(){}.call(this),function(){Gmaps4Rails.Google={},Gmaps4Rails.Google.Shared={createPoint:function(e,t){return new google.maps.Point(e,t)},createSize:function(e,t){return new google.maps.Size(e,t)},createLatLng:function(e,t){return new google.maps.LatLng(e,t)},createLatLngBounds:function(){return new google.maps.LatLngBounds},clear:function(){return this.serviceObject.setMap(null)},show:function(){return this.serviceObject.setVisible(!0)},hide:function(){return this.serviceObject.setVisible(!1)},isVisible:function(){return this.serviceObject.getVisible()}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Google.Circle=function(e){function r(e,t){var r,o;this.controller=t,e===this.controller.circles[0]&&(null!=e.strokeColor&&(this.controller.circles_conf.strokeColor=e.strokeColor),null!=e.strokeOpacity&&(this.controller.circles_conf.strokeOpacity=e.strokeOpacity),null!=e.strokeWeight&&(this.controller.circles_conf.strokeWeight=e.strokeWeight),null!=e.fillColor&&(this.controller.circles_conf.fillColor=e.fillColor),null!=e.fillOpacity&&(this.controller.circles_conf.fillOpacity=e.fillOpacity)),null!=e.lat&&null!=e.lng&&(r={center:this.createLatLng(e.lat,e.lng),strokeColor:e.strokeColor||this.controller.circles_conf.strokeColor,strokeOpacity:e.strokeOpacity||this.controller.circles_conf.strokeOpacity,strokeWeight:e.strokeWeight||this.controller.circles_conf.strokeWeight,fillOpacity:e.fillOpacity||this.controller.circles_conf.fillOpacity,fillColor:e.fillColor||this.controller.circles_conf.fillColor,clickable:e.clickable||this.controller.circles_conf.clickable,zIndex:e.zIndex||this.controller.circles_conf.zIndex,radius:e.radius},o=this.mergeObjects(this.controller.circles_conf.raw,r),this.serviceObject=new google.maps.Circle(o),this.serviceObject.setMap(this.controller.getMapObject()))}return t(r,e),r.include(Gmaps4Rails.Interfaces.Basic),r.include(Gmaps4Rails.Google.Shared),r.extend(Gmaps4Rails.Circle.Class),r.extend(Gmaps4Rails.Configuration),r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Google.Kml=function(e){function r(e,t){var r;this.controller=t,this.options=e.options||{},this.options=this.mergeObjects(this.options,this.DEFAULT_CONF),r=new google.maps.KmlLayer(e.url,this.options),r.setMap(this.controller.getMapObject()),this.serviceObject=r}return t(r,e),r.include(Gmaps4Rails.Interfaces.Basic),r.include(Gmaps4Rails.Google.Shared),r.include(Gmaps4Rails.Kml.Instance),r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};Gmaps4Rails.Google.Map=function(e){function r(e,t){var r,o,n;this.controller=t,r=this.setConf(),this.options=this.mergeObjects(e,r),o={maxZoom:this.options.maxZoom,minZoom:this.options.minZoom,zoom:this.options.zoom,center:this.createLatLng(this.options.center_latitude,this.options.center_longitude),mapTypeId:google.maps.MapTypeId[this.options.type],mapTypeControl:this.options.mapTypeControl,disableDefaultUI:this.options.disableDefaultUI,disableDoubleClickZoom:this.options.disableDoubleClickZoom,draggable:this.options.draggable},n=this.mergeObjects(e.raw,o),this.serviceObject=new google.maps.Map(document.getElementById(this.options.id),n)}return t(r,e),r.include(Gmaps4Rails.Interfaces.Map),r.include(Gmaps4Rails.Map),r.include(Gmaps4Rails.Google.Shared),r.include(Gmaps4Rails.Configuration),r.prototype.CONF={disableDefaultUI:!1,disableDoubleClickZoom:!1,type:"ROADMAP",mapTypeControl:null},r.prototype.extendBoundsWithMarker=function(e){return this.boundsObject.extend(e.serviceObject.position)},r.prototype.extendBoundsWithPolyline=function(e){var t,r,o,n,i;for(r=e.serviceObject.latLngs.getArray()[0].getArray(),i=[],o=0,n=r.length;n>o;o++)t=r[o],i.push(this.boundsObject.extend(t));return i},r.prototype.extendBoundsWithPolygon=function(e){var t,r,o,n,i;for(r=e.serviceObject.latLngs.getArray()[0].getArray(),i=[],o=0,n=r.length;n>o;o++)t=r[o],i.push(this.boundsObject.extend(t));return i},r.prototype.extendBoundsWithCircle=function(e){return this.boundsObject.extend(e.serviceObject.getBounds().getNorthEast()),this.boundsObject.extend(e.serviceObject.getBounds().getSouthWest())},r.prototype.extendBound=function(e){return this.boundsObject.extend(this.createLatLng(e.lat,e.lng))},r.prototype.adaptToBounds=function(){var e;return this.options.auto_zoom?this.fitBounds():(e=this.boundsObject.getCenter(),this.options.center_latitude=e.lat(),this.options.center_longitude=e.lng(),this.serviceObject.setCenter(e))},r.prototype.fitBounds=function(){return this.boundsObject.isEmpty()?void 0:this.serviceObject.fitBounds(this.boundsObject)},r.prototype.centerMapOnUser=function(e){return this.serviceObject.setCenter(e)},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};Gmaps4Rails.Google.Marker=function(e){function r(e,t){var r;this.controller=t,r=this.createLatLng(e.lat,e.lng),this._isBasicMarker(e)?this._createBasicMarker(r,e):null!=e.rich_marker?this._createRichMarker(r,e):this._createMarker(r,e)}return t(r,e),r.include(Gmaps4Rails.Interfaces.Marker),r.include(Gmaps4Rails.Google.Shared),r.include(Gmaps4Rails.Marker.Instance),r.extend(Gmaps4Rails.Marker.Class),r.extend(Gmaps4Rails.Configuration),r.CONF={clusterer_gridSize:50,clusterer_maxZoom:5,custom_cluster_pictures:null,custom_infowindow_class:null,raw:{}},r.prototype.createInfoWindow=function(){var e;return"function"==typeof this.controller.jsTemplate||null!=this.description?("function"==typeof this.controller.jsTemplate&&(this.description=this.controller.jsTemplate(this)),null!=this.controller.markers_conf.custom_infowindow_class?(e=document.createElement("div"),e.setAttribute("class",this.controller.markers_conf.custom_infowindow_class),e.innerHTML=this.description,this.infowindow=new InfoBox(this.infobox(e)),google.maps.event.addListener(this.serviceObject,"click",this._openInfowindow())):(this.infowindow=new google.maps.InfoWindow({content:this.description}),google.maps.event.addListener(this.serviceObject,"click",this._openInfowindow()))):void 0},r.prototype._createBasicMarker=function(e,t){var r,o;return r={position:e,map:this.getMap(),title:t.marker_title,draggable:t.marker_draggable,zIndex:t.zindex},o=this.mergeObjects(this.controller.markers_conf.raw,r),this.serviceObject=new google.maps.Marker(o)},r.prototype._createRichMarker=function(e,t){var r,o;return this.serviceObject=new RichMarker({position:e,map:this.getMap(),draggable:t.marker_draggable,content:t.rich_marker,flat:(null!=(r=null!=t.marker_anchor)?r:t.marker_anchor[1])?void 0:!1,anchor:(null!=(o=null!=t.marker_anchor)?o:t.marker_anchor[0])?void 0:null,zIndex:t.zindex})},r.prototype._createMarker=function(e,t){var r,o,n,i,s,l;return o=this._createImageAnchorPosition(t.marker_anchor),s=this._createImageAnchorPosition(t.shadow_anchor),n=this._createOrRetrieveImage(t.marker_picture,t.marker_width,t.marker_height,o),l=this._createOrRetrieveImage(t.shadow_picture,t.shadow_width,t.shadow_height,s),r={position:e,map:this.getMap(),icon:n,title:t.marker_title,draggable:t.marker_draggable,shadow:l,zIndex:t.zindex},i=this.mergeObjects(this.controller.markers_conf.raw,r),this.serviceObject=new google.maps.Marker(i)},r.prototype._includeMarkerImage=function(e){var t,r,o,n,i;for(i=this.controller.markerImages,t=o=0,n=i.length;n>o;t=++o)if(r=i[t],r.url===e)return t;return!1},r.prototype._createOrRetrieveImage=function(e,t,r,o){var n,i;return"undefined"==typeof e||""===e||null===e?null:(i=this._includeMarkerImage(e))?"number"==typeof i?this.controller.markerImages[i]:!1:(n=this._createMarkerImage(e,this.createSize(t,r),null,o,null),this.controller.markerImages.push(n),n)},r.prototype._isBasicMarker=function(e){return null==e.marker_picture&&null==e.rich_marker},r.prototype._createMarkerImage=function(e,t,r,o,n){return new google.maps.MarkerImage(e,t,r,o,n)},r.prototype._createImageAnchorPosition=function(e){return null===e?null:this.createPoint(e[0],e[1])},r.prototype._openInfowindow=function(){var e;return e=this,function(){return e.controller._closeVisibleInfoWindow(),e.infowindow.open(e.getMap(),e.serviceObject),e.controller._setVisibleInfoWindow(e.infowindow)}},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Google.Polygon=function(e){function r(e,t){var r,o,n,i,s,l,a,c,u,p,h,d,f,m;for(this.controller=t,c=[],f=0,m=e.length;m>f;f++)l=e[f],i=this.createLatLng(l.lat,l.lng),c.push(i),l===e[0]&&(u=l.strokeColor||this.controller.polygons_conf.strokeColor,p=l.strokeOpacity||this.controller.polygons_conf.strokeOpacity,h=l.strokeWeight||this.controller.polygons_conf.strokeWeight,o=l.fillColor||this.controller.polygons_conf.fillColor,n=l.fillOpacity||this.controller.polygons_conf.fillOpacity,r=l.clickable||this.controller.polygons_conf.clickable,d=l.zIndex||this.controller.polygons_conf.zIndex);a={path:c,strokeColor:u,strokeOpacity:p,strokeWeight:h,clickable:r,zIndex:d},s=this.mergeObjects(t.polygons_conf.raw,a),this.serviceObject=new google.maps.Polygon(s),this.serviceObject.setMap(t.getMapObject())}return t(r,e),r.include(Gmaps4Rails.Interfaces.Basic),r.include(Gmaps4Rails.Google.Shared),r.extend(Gmaps4Rails.Polygon.Class),r.extend(Gmaps4Rails.Configuration),r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Google.Polyline=function(e){function r(e,t){var r,o,n,i,s,l,a,c,u,p,h,d,f,m,y,g;for(c=[],f=0,y=e.length;y>f;f++)if(n=e[f],null!=n.coded_array)for(o=new google.maps.geometry.encoding.decodePath(n.coded_array),m=0,g=o.length;g>m;m++)l=o[m],c.push(l);else n===e[0]&&(u=n.strokeColor||t.polylines_conf.strokeColor,p=n.strokeOpacity||t.polylines_conf.strokeOpacity,h=n.strokeWeight||t.polylines_conf.strokeWeight,r=n.clickable||t.polylines_conf.clickable,d=n.zIndex||t.polylines_conf.zIndex,i=n.icons||t.polylines_conf.icons),null!=n.lat&&null!=n.lng&&c.push(this.createLatLng(n.lat,n.lng));a={path:c,strokeColor:u,strokeOpacity:p,strokeWeight:h,clickable:r,zIndex:d,icons:i},s=this.mergeObjects(t.polylines_conf.raw,a),this.serviceObject=new google.maps.Polyline(s),this.serviceObject.setMap(t.getMapObject())}return t(r,e),r.include(Gmaps4Rails.Interfaces.Basic),r.include(Gmaps4Rails.Google.Shared),r.extend(Gmaps4Rails.Polyline.Class),r.extend(Gmaps4Rails.Configuration),r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4RailsGoogle=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.markerImages=[]}return t(r,e),r.include(Gmaps4Rails.Google.Shared),r.prototype.getModule=function(){return Gmaps4Rails.Google},r.prototype.createClusterer=function(e){return new MarkerClusterer(this.getMapObject(),e,{maxZoom:this.markers_conf.clusterer_maxZoom,gridSize:this.markers_conf.clusterer_gridSize,styles:this.customClusterer()})},r.prototype.clearClusterer=function(){return this.markerClusterer.clearMarkers()},r.prototype.clusterize=function(){var e,t,r,o,n;if(this.markers_conf.do_clustering){for(null!=this.markerClusterer&&this.clearClusterer(),t=[],n=this.markers,r=0,o=n.length;o>r;r++)e=n[r],t.push(e.serviceObject);return this.markerClusterer=this.createClusterer(t)}},r.prototype._closeVisibleInfoWindow=function(){return null!=this.visibleInfowindow?this.visibleInfowindow.close():void 0},r.prototype._setVisibleInfoWindow=function(e){return this.visibleInfowindow=e},r}(Gmaps4Rails.BaseController)}.call(this),function(){}.call(this),function(){Gmaps4Rails.Openlayers={},Gmaps4Rails.Openlayers.Shared={createPoint:function(e,t){return new OpenLayers.Geometry.Point(t,e)},createLatLng:function(e,t){return new OpenLayers.LonLat(t,e).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))},createAnchor:function(e){return null===e?null:new OpenLayers.Pixel(e[0],e[1])},createSize:function(e,t){return new OpenLayers.Size(e,t)},createLatLngBounds:function(){return new OpenLayers.Bounds}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Openlayers.Map=function(e){function r(e,t){var r,o,n;this.controller=t,r=this.setConf(),this.options=this.mergeObjects(e,r),n={center:this.createLatLng(this.options.center_latitude,this.options.center_longitude),zoom:this.options.zoom},o=this.mergeObjects(e.raw,n),this.serviceObject=new OpenLayers.Map(this.options.id,o),this.serviceObject.addLayer(new OpenLayers.Layer.OSM)}return t(r,e),r.include(Gmaps4Rails.Interfaces.Map),r.include(Gmaps4Rails.Map),r.include(Gmaps4Rails.Openlayers.Shared),r.include(Gmaps4Rails.Configuration),r.prototype.CONF={disableDefaultUI:!1,disableDoubleClickZoom:!1,type:"ROADMAP",mapTypeControl:null},r.prototype.extendBoundsWithMarker=function(e){return this.boundsObject.extend(this.createLatLng(e.lat,e.lng))},r.prototype.extendBoundsWithPolyline=function(){},r.prototype.extendBoundsWithPolygon=function(){},r.prototype.extendBoundsWithCircle=function(){},r.prototype.extendBound=function(){},r.prototype.fitBounds=function(){return this.serviceObject.zoomToExtent(this.boundsObject,!0)},r.prototype.adaptToBounds=function(){return this.fitBounds()},r.prototype.centerMapOnUser=function(e){return this.serviceObject.setCenter(e)},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Openlayers.Marker=function(e){function r(e,t){this.controller=t,this.controller._createMarkersLayer(),this._createMarkerStyle(e),this._isBasicMarker(e)?this._styleForBasicMarker(e):this._styleForCustomMarker(e),this.serviceObject=new OpenLayers.Feature.Vector(this.createPoint(e.lat,e.lng),null,this.style_mark),this.serviceObject.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.controller.markersLayer.addFeatures([this.serviceObject])
}return t(r,e),r.include(Gmaps4Rails.Interfaces.Marker),r.include(Gmaps4Rails.Openlayers.Shared),r.include(Gmaps4Rails.Marker.Instance),r.extend(Gmaps4Rails.Marker.Class),r.extend(Gmaps4Rails.Configuration),r.prototype.createInfoWindow=function(){return null!=this.description?this.serviceObject.infoWindow=this.description:void 0},r.prototype.isVisible=function(){return!0},r.prototype._isBasicMarker=function(e){return null==e.marker_picture},r.prototype._createMarkerStyle=function(e){return this.style_mark=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),this.style_mark.fillOpacity=1,this.style_mark.graphicTitle=e.marker_title},r.prototype._styleForBasicMarker=function(){return this.style_mark.graphicHeight=30,this.style_mark.externalGraphic="http://openlayers.org/dev/img/marker-blue.png"},r.prototype._styleForCustomMarker=function(e){return this.style_mark.graphicWidth=e.marker_width,this.style_mark.graphicHeight=e.marker_height,this.style_mark.externalGraphic=e.marker_picture,null!=e.marker_anchor&&(this.style_mark.graphicXOffset=e.marker_anchor[0],this.style_mark.graphicYOffset=e.marker_anchor[1]),null!=e.shadow_picture&&(this.style_mark.backgroundGraphic=e.shadow_picture,this.style_mark.backgroundWidth=e.shadow_width,this.style_mark.backgroundHeight=e.shadow_height,null!=e.shadow_anchor)?(this.style_mark.backgroundXOffset=e.shadow_anchor[0],this.style_mark.backgroundYOffset=e.shadow_anchor[1]):void 0},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4Rails.Openlayers.Polyline=function(e){function r(e,t){var r,o,n,i,s,l,a,c,u,p,h,d;for(this.controller=t,this.controller._createPolylinesLayer(),l=[],h=0,d=e.length;d>h;h++)o=e[h],o===e[0]&&(a=o.strokeColor||this.controller.polylines_conf.strokeColor,c=o.strokeOpacity||this.controller.polylines_conf.strokeOpacity,u=o.strokeWeight||this.controller.polylines_conf.strokeWeight,r=o.clickable||this.controller.polylines_conf.clickable,p=o.zIndex||this.controller.polylines_conf.zIndex),null!=o.lat&&null!=o.lng&&(n=new OpenLayers.Geometry.Point(o.lng,o.lat),l.push(n));i=new OpenLayers.Geometry.LineString(l),s={strokeColor:a,strokeOpacity:c,strokeWidth:u},this.serviceObject=new OpenLayers.Feature.Vector(i,null,s),this.serviceObject.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.controller.polylinesLayer.addFeatures([this.serviceObject])}return t(r,e),r.include(Gmaps4Rails.Interfaces.Basic),r.include(Gmaps4Rails.Openlayers.Shared),r.extend(Gmaps4Rails.Polyline.Class),r.extend(Gmaps4Rails.Configuration),r.prototype.isVisible=function(){return!0},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};this.Gmaps4RailsOpenlayers=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.markersControl=null,this.markersLayer=null,this.polylinesLayer=null}return t(r,e),r.include(Gmaps4Rails.Openlayers.Shared),r.prototype.getModule=function(){return Gmaps4Rails.Openlayers},r.prototype.createClusterer=function(e){var t,r;return r=new OpenLayers.Style(this._clustererOptions,this._clustererFunctions),t=new OpenLayers.Strategy.Cluster,this._clearMarkersLayer(),this.clusterLayer=new OpenLayers.Layer.Vector("Clusters",{strategies:[t],styleMap:new OpenLayers.StyleMap({"default":r,select:{fillColor:"#8aeeef",strokeColor:"#32a8a9"}})}),this.getMapObject().addLayer(this.clusterLayer),this.clusterLayer.addFeatures(e),this.clusterLayer},r.prototype.clearClusterer=function(){return null!=this.clusterLayer&&null!=this.getMapObject().getLayer(this.clusterLayer.id)&&this.getMapObject().removeLayer(this.markerClusterer),this.clusterLayer=null},r.prototype.clearMarkers=function(){return this._clearMarkersLayer(),this.clearClusterer(),this.markers=[]},r.prototype._createPolylinesLayer=function(){return null==this.polylinesLayer?(this.polylinesLayer=new OpenLayers.Layer.Vector("Polylines",null),this.polylinesLayer.events.register("featureselected",this.polylinesLayer,this._onFeatureSelect),this.polylinesLayer.events.register("featureunselected",this.polylinesLayer,this._onFeatureUnselect),this.polylinesControl=new OpenLayers.Control.DrawFeature(this.polylinesLayer,OpenLayers.Handler.Path),this.getMapObject().addLayer(this.polylinesLayer),this.getMapObject().addControl(this.polylinesControl)):void 0},r.prototype._createMarkersLayer=function(){return null==this.markersLayer?(this.markersLayer=new OpenLayers.Layer.Vector("Markers",null),this.getMapObject().addLayer(this.markersLayer),this.markersLayer.events.register("featureselected",this.markersLayer,this._onFeatureSelect()),this.markersLayer.events.register("featureunselected",this.markersLayer,this._onFeatureUnselect()),this.markersControl=new OpenLayers.Control.SelectFeature(this.markersLayer),this.getMapObject().addControl(this.markersControl),this.markersControl.activate()):void 0},r.prototype._clearMarkersLayer=function(){return null!=this.markersLayer&&null!=this.getMapObject().getLayer(this.markersLayer.id)&&this.getMapObject().removeLayer(this.markersLayer),this.markersLayer=null},r.prototype._onFeatureSelect=function(){var e;return e=this,function(t){var r,o;return r=t.feature,o=new OpenLayers.Popup.FramedCloud("featurePopup",r.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(300,200),r.infoWindow,null,!0,e._onPopupClose(e,r)),r.popup=o,o.feature=r,e.getMapObject().addPopup(o)}},r.prototype._onFeatureUnselect=function(){var e;return e=this,function(t){var r;return r=t.feature,null!=r.popup?(e.getMapObject().removePopup(r.popup),r.popup.destroy(),r.popup=null):void 0}},r.prototype._onPopupClose=function(e,t){return function(){return e.markersControl.unselect(t)}},r.prototype._clustererFunctions={context:{width:function(e){var t;return null!=(t=e.cluster)?t:{2:1}},radius:function(e){var t;return t=2,e.cluster&&(t=e.cluster.length+10),t},label:function(e){return e.cluster?e.cluster.length:""}}},r.prototype._clustererOptions={pointRadius:"${radius}",fillColor:"#ffcc66",fillOpacity:.8,strokeColor:"#cc6633",strokeWidth:"${width}",label:"${label}"},r}(Gmaps4Rails.BaseController)}.call(this),function(){}.call(this);