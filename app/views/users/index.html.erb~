<% provide(:title, 'All users') %>
<% provide(:site_section, "4") %>
<h1>All users</h1>

<%= render 'user_search' %>

<div id="user_results">
  <% if current_user.admin? %>
    <% if @schools.any? %>
      <%= will_paginate @users %>
      <% @schools.each do |school| %>
        <% @people = @users.select {|u| u.school == school.name } %>
        <% if @people.any? %>
          <h4><%= school.name %></h4>
          <ul class="generic-list">
            <%= render @people, size: 52 %>
          </ul>
        <% else %>
          No users at this school.
        <% end %>
      <% end %>
      <%= will_paginate @users %>
    <% else %>
      No users.
    <% end %>

  <% else %>
    <h4><%= current_user.school.to_s %></h4>
    <% if @users.any? %>
      <ul class="generic-list">
        <%= will_paginate @users %>
        <%= render @users, size: 52 %>
        <%= will_paginate @users %>
      </ul>
    <% else %>
      No users at this school.
    <% end %>
  <% end %>
</div>
